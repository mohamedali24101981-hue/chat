<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <div class="chat-container">
        <div style="padding:10px; background:var(--card); display:flex; align-items:center; gap:8px;">
            <button onclick="location.href='users.html'" style="width:auto; padding:4px 8px; font-size:11px;">ðŸ”™</button>
            <div><b id="target" style="font-size:13px;"></b><br><small id="status" style="color:#22c55e; font-size:10px;"></small></div>
        </div>
        <div id="msgs" class="chat-msgs"></div>
        <div class="chat-input-area">
            <input id="in" placeholder="Ø±Ø³Ø§Ù„Ø©..." style="flex:1;">
            <button id="send" style="width:45px;">ðŸš€</button>
        </div>
    </div>
    <script src="Firebase.js"></script>
    <script>
        const me = localStorage.getItem("me"), to = localStorage.getItem("to");
        const id = [me, to].sort().join("_");
        document.getElementById("target").innerText = to;

        db.ref("users/"+to+"/online").on("value", s => {
            document.getElementById("status").innerText = s.val() ? "Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†" : "Ø£ÙˆÙÙ„Ø§ÙŠÙ†";
        });

        db.ref("chats/"+id).on("child_added", s => {
            const m = s.val();
            const time = new Date(m.ts).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const d = document.createElement("div");
            d.className = "m " + (m.f === me ? "me" : "other");
            d.innerHTML = `${m.t} <span class="time">${time}</span>`;
            document.getElementById("msgs").appendChild(d);
            document.getElementById("msgs").scrollTop = document.getElementById("msgs").scrollHeight;
        });

        document.getElementById("send").onclick = () => {
            const t = document.getElementById("in").value.trim();
            if(t) { db.ref("chats/"+id).push({f:me, t:t, ts: Date.now()}); document.getElementById("in").value=""; }
        };
    </script>
</body>
</html>

